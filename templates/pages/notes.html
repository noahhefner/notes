<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Papernote</title>
    <script src="https://unpkg.com/htmx.org@1.9.11"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" type="text/css" href="/static/css/styles.css" /> -->
  </head>
  <body>
    <header>
      <div class="header-sub">
        <img src="/static/img/logo.png" alt="logo" />
        <h1>Papernote</h1>
      </div>
      <input
        hx-get="/search"
        hx-target="#left-pane"
        hx-trigger="change, keyup delay:500ms"
        hx-swap="innerHTML"
        class="search"
        type="text"
        name="query"
        size="64"
        placeholder="Search by Filename"
      />
      <button id="logout-button" hx-post="/logout" hx-trigger="click">
        Logout
      </button>
    </header>    
    <main class="app-container">
      <div class="note-container">
        <div class="left-pane" id="left-pane">
          <div class="new-note-wrapper" id="new-note-wrapper">
            <button
              hx-get="/clickedNewNote"
              hx-trigger="click"
              hx-target="#new-note-wrapper"
              hx-swap="outerHTML"
              class="new-note"
            >
              New Note
            </button>
          </div>
          <div class="note-list" id="note-list">
            {{ range .FileNames }}
            <div
              id="{{ . }}"
              class="note-entry-wrapper"
              onmouseover="startTimer(this)"
              onmouseout="clearTimer(this)"
            >
              <input
                type="image"
                src="/static/img/delete-notes.svg"
                class="delete-link"
                hx-delete="/notes/{{ . }}"
                hx-trigger="click"
                hx-confirm="Delete {{ . }}?"
                hx-target="closest div"
                hx-swap="outerHTML"
              />
              <a href="/notes/fullpagenoteview/{{ . }}" class="fullpage-link"></a>
              <a href="/notes/edit/{{ . }}" class="edit-link"></a>
              <p class="note-title">{{ . }}</p>
            </div>
            {{ end }}
          </div>
        </div>
        <div id="preview" class="right-pane"></div>
      </div>
    </main>
    <script>
      /* 
      When the user hovers over the filename div, wait for 200ms before sending
      a request to get the file contents to populate the preview pane. If the cursor
      is moved off of the filename div before the 200ms has elapsed, the request
      is never sent. This prevents HTMX from firing off tons of requests if the user 
      quickly moves the cursor up and down over the file list.
      */
    
      var timer;
      var delay = 200;
    
      function startTimer(element) {
          timer = setTimeout(function () {
            htmx.ajax(
              'GET',
              '/notes/' + element.id,
              {
                target: '#preview',
                swap: 'innerHTML'
              }
            )
          }, delay);
      }
    
      function clearTimer(element) {
          clearTimeout(timer);
      }
    </script>
  </body>
</html>
